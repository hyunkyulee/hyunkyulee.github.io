<!DOCTYPE html>
<html>
  <head>
    <title>Hyunkyu Lee-Figures</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet" media="screen">
    <!-- Custom styles for this template -->
    <link href="css/kyuTemplate.css" rel="stylesheet">


    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="../../assets/js/html5shiv.js"></script>
      <script src="../../assets/js/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>

    <div class="navbar navbar-inverse navbar-fixed-top bs-docs-nav">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Hyunkyu Lee</a>
        </div>
        <div class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li><a href="index.html">Home</a></li>
            <li><a href="pub.html">Publication</a></li>
            <li class="active">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Research <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li class="divider"></li>
                <li class="dropdown-header">Under review</li>
                <li><a href="figure_frontiers.html">SF Predictor Figures</a></li>
                <li><a href="table_frontiers.html">SF Predictor Tables</a></li>
                <li class="divider"></li>
                <li class="dropdown-header">2014 APS</li>
                <li><a href="research_bb.html">Lifestyle and Cognition</a></li>
                <li class="divider"></li>
                <li class="dropdown-header">Space Fortress</li>
                <li><a href="research_sf.html">SF installation</a></li>
              </ul>
            </li>
            <li><a href="misc.html">Misc</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>
    
    <div class="container">  

      <div class="starter-template">
        <h1>Forecasting cognitive benefit from game training</h1>
      </div>

      <style>
      html, body {
        font-family: "Helvetica Neue";
        margin: 10px;
        padding: 0px;
        border: 0px;
      }

      .text {
        font: 16px "Helvetica Neue";
      }

      .dot {
        stroke: #000;
      }

      .axis path, .axis line {
        fill: none;
        stroke: #000;
        shape-rendering: crispEdges;
      }

      .label {
        fill: #777;
        font: 18px "Helvetica Neue";
      }


      .year.label {
        font: 500 196px "Helvetica Neue";
        fill: #ddd;
      }

      .session.label {
        font: 30px "Helvetica Neue";
        fill: #ddd;
      }

      .overlay {
        fill: none;
        pointer-events: all;
        cursor: ew-resize;
      }

      .legend rect {
        fill:white;
        opacity:0.8;
      }

      #wrap {
         width:1100px;
         margin:0 auto;
      }
      #left_col {
         float:left;
         width:600px;
      }
      #right_col {
         float:right;
         width:450px;
      }
      #wrap2 {
         width:1100px;
         margin:0 auto;
      }
      #left_col2 {
         float:left;
         width:500px;
      }
      #right_col2 {
         float:right;
         width:500px;
      }
      .line {
        fill: none;
        stroke: #2ca02c;
        stroke-width: 1.5px;
      }
      .line2 {
        fill: none;
        stroke: #d62728;
        stroke-width: 1.5px;
      }
      .line-1 {
              fill: none;
              stroke: #1f77b4;
              stroke-width: 1.5px;
      }
      .line-2 {
        fill: none;
        stroke: #ff7f0e;
        stroke-width: 1.5px;
      }
      .reg_fet {
        fill: none;
        stroke: #2ca02c;
        stroke-width: 1.5px;
      }
      .reg_hvt {
        fill: none;
        stroke: #d62728;
        stroke-width: 1.5px;
      }
  
      </style>
      
      <h2>Relation between baseline ability and game performance by trainign regimen</h2>
      <aside style="color:#848484;font-size:23px;">Partial correlation between baseline cognitive abilities and game performance while controlling gender</aside>
      <aside style="color:#848484;font-size:16px;">Mouseover the session to move forward and backwards through training.</aside>

      <div class='chart'id="wrap">
          <div id="left_col">
              <p id="chart"></p>
          </div>
          <div id="right_col">
              <p id="chartCor"></p>
          </div>
      </div>
      <div id="wrap">
          <div id="left_col">
              <p id="chart2"></p>
          </div>
          <div id="right_col">
              <p id="chartCor2"></p>
          </div>
      </div>

    <h2>Relation between baseline ability and game performance</h2> 
      <aside style="color:#848484;font-size:23px;">Partial correlation between baseline cognitive abilities and game performance while controlling gender</aside> 
      <p id="chart-general"></p>
      
    <h2>Relation between baseline ability and training success</h2>
      <aside style="color:#848484;font-size:23px;">Partial correlation between baseline cognitive abilities and game improvement while controlling gender and baseline game performance</aside>
      <aside style="color:#848484;font-size:16px;padding-top:10px;">Toggle the training phase by clicking on the button.</aside>
      
      <div style="padding-top:6px;" class="btn-group">
          <button type="button" class="btn btn-default" id = "update1">ALL</button>
          <button type="button" class="btn btn-default" id = "update2">Early</button>
          <button type="button" class="btn btn-default" id = "update3">Middle</button>
          <button type="button" class="btn btn-default" id = "update4">Late</button>
      </div>
     
     <div id="wrap2">
          <div id="left_col2">
              <p id="chart3"></p>
          </div>
          <div id="right_col2">
              <p id="chart3_1"></p>
          </div>
      </div>
     
      <h2>Relation between game success and transfer success</h2>
      <aside style="color:#848484;font-size:23px;">Partial correlation between transfer of cognitive function and game improvement while controlling gender and baseline game performance</aside>
      <aside style="color:#848484;font-size:16px;padding-top:10px;">Toggle training phase by clicking on the button.</aside>
      <div style="padding-top:6px;" class="btn-group">
          <button type="button" class="btn btn-default" id = "update5">ALL</button>
          <button type="button" class="btn btn-default" id = "update6">Early</button>
          <button type="button" class="btn btn-default" id = "update7">Middle</button>
          <button type="button" class="btn btn-default" id = "update8">Late</button>
      </div>
      <div id="wrap2">
          <div id="left_col2">
              <p id="chart4"></p>
          </div>
          <div id="right_col2">
              <p id="chart4_1"></p>
          </div>
      </div>

      <script src="http://d3js.org/d3.v2.js"></script>
      <script src="https://raw.github.com/tmcw/simple-statistics/master/src/simple_statistics.js"></script>
      <script src="js/d3.legend.js"></script>
      
      <script>

      // Various accessors that specify the four dimensions of data to visualize.
      function x(d) { return d.gameScore; }
      function y(d) { return d.baselineEF; }
      function name(d) {return d.name}
      function radius(d) {return 10}
      function color(d) { return d.group; }
      function key(d) { return d.name; }

      // Chart dimensions.
      var margin = {top: 19.5, right: 24.5, bottom: 60, left: 50},
          width = 600 - margin.right,
          widthImprove = 500 - margin.right,
          widthCor = 450 - margin.right,
          height = 450 - margin.top - margin.bottom;


      // Various scales. These domains make assumptions of data, naturally.
      var xScale = d3.scale.linear().domain([-5000, 8000]).range([0, width]),
          ximproveScale = d3.scale.linear().domain([-4000, 4000]).range([0, widthImprove]),
          xCorScale = d3.scale.linear().domain([0, 15]).range([0, widthCor]),
          yScale = d3.scale.linear().domain([-15, 15]).range([height, 0]),
          yCorScale = d3.scale.linear().domain([0, 1]).range([height, 0]),
          radiusScale = d3.scale.sqrt().domain([0, 5e8]).range([0, 40]),
          colorScale = d3.scale.category10();
      // The x & y axes.
      var xAxis = d3.svg.axis().orient("bottom").scale(xScale).ticks(12, d3.format(",d")),
          ximproveAxis = d3.svg.axis().orient("bottom").scale(ximproveScale).ticks(12, d3.format(",d")),
          yAxis = d3.svg.axis().scale(yScale).orient("left"),
          xCorAxis = d3.svg.axis().orient("bottom").scale(xCorScale).ticks(12, d3.format(",d")),
          yCorAxis = d3.svg.axis().scale(yCorScale).orient("left");

      // Create the SVG container and set the origin.
      var svg = d3.select("#chart").append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      var svg_c = d3.select("#chartCor").append("svg")
          .attr("width", widthCor + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      // Create second SVG container and set the origin.
      var svg2 = d3.select("#chart2").append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      var svg_c2 = d3.select("#chartCor").append("svg")
          .attr("width", widthCor + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      var svg3 = d3.select("#chart3").append("svg")
          .attr("width", widthImprove + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

     var svg3_1 = d3.select("#chart3_1").append("svg")
          .attr("width", widthImprove + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
      
      // Create second SVG container and set the origin.
      var svg4 = d3.select("#chart4").append("svg")
          .attr("width", widthImprove + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      var svg4_1 = d3.select("#chart4_1").append("svg")
          .attr("width", widthImprove + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

      // Add the x-axis.
      svg.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + height + ")")
          .call(xAxis);

      svg_c.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + height + ")")
          .call(xCorAxis);

      svg2.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + height + ")")
          .call(xAxis);

      svg_c2.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + height + ")")
          .call(xCorAxis);

      svg3.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + height + ")")
          .call(ximproveAxis);

      svg3_1.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + height + ")")
          .call(ximproveAxis);

      svg4.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + height + ")")
          .call(ximproveAxis);

      svg4_1.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + height + ")")
          .call(ximproveAxis);

      // Add the y-axis.
      svg.append("g")
          .attr("class", "y axis")
          .call(yAxis);

      svg_c.append("g")
          .attr("class", "y axis")
          .call(yCorAxis);

      svg2.append("g")
          .attr("class", "y axis")
          .call(yAxis);

      svg_c2.append("g")
          .attr("class", "y axis")
          .call(yCorAxis);
      
      svg3.append("g")
          .attr("class", "y axis")
          .call(yAxis);

      svg3_1.append("g")
          .attr("class", "y axis")
          .call(yAxis);

      svg4.append("g")
          .attr("class", "y axis")
          .call(yAxis);

      svg4_1.append("g")
          .attr("class", "y axis")
          .call(yAxis);

      // Add an x-axis label.
      svg.append("text")
          .attr("class", "x label")
          .attr("text-anchor", "middle")
          .attr("x", width/2)
          .attr("y", height + 50)
          .text("Space Fortress game performance");

      svg_c.append("text")
          .attr("class", "x label")
          .attr("text-anchor", "middle")
          .attr("x", widthCor/2)
          .attr("y", height + 50)
          .text("Training Session");

      svg2.append("text")
          .attr("class", "x label")
          .attr("text-anchor", "middle")
          .attr("x", width/2)
          .attr("y", height +50)
          .text("Space Fortress game performance");

      svg_c2.append("text")
          .attr("class", "x label")
          .attr("text-anchor", "middle")
          .attr("x", widthCor/2)
          .attr("y", height + 50)
          .text("Training Session");
    
      svg3.append("text")
          .attr("class", "x label")
          .attr("text-anchor", "middle")
          .attr("x", widthImprove/2)
          .attr("y", height +50)
          .text("Success of game training "); 

      svg3_1.append("text")
          .attr("class", "x label")
          .attr("text-anchor", "middle")
          .attr("x", widthImprove/2)
          .attr("y", height +50)
          .text("Success of game training ");

      svg4.append("text")
          .attr("class", "x label")
          .attr("text-anchor", "middle")
          .attr("x", widthImprove/2)
          .attr("y", height +50)
          .text("Success of game training ");

      svg4_1.append("text")
          .attr("class", "x label")
          .attr("text-anchor", "middle")
          .attr("x", widthImprove/2)
          .attr("y", height +50)
          .text("Success of game training ");

      // Add a y-axis label.
      svg.append("text")
          .attr("class", "y label")
          .attr("text-anchor", "end")
          .attr("y", -50)
          .attr("dy", ".75em")
          .attr("transform", "rotate(-90)")
          .text("Baseline Executive Function (Composite Score)");

      svg_c.append("text")
          .attr("class", "y label")
          .attr("text-anchor", "end")
          .attr("y", -50)
          .attr("dy", ".75em")
          .attr("transform", "rotate(-90)")
          .text("Correlation game score and baseline EF (r)");

      svg_c2.append("text")
          .attr("class", "y label")
          .attr("text-anchor", "end")
          .attr("y", -50)
          .attr("dy", ".75em")
          .attr("transform", "rotate(-90)")
          .text("Correlation game score and baseline SM (r)");

      svg2.append("text")
          .attr("class", "y label")
          .attr("text-anchor", "end")
          .attr("y", -50)
          .attr("dy", ".75em")
          .attr("transform", "rotate(-90)")
          .text("Baseline Speeded Memory (Composite Score)");

      svg3.append("text")
          .attr("class", "y label")
          .attr("text-anchor", "end")
          .attr("y", -50)
          .attr("dy", ".75em")
          .attr("transform", "rotate(-90)")
          .text("Baseline Executive Function (Composite Score)");

      svg3_1.append("text")
          .attr("class", "y label")
          .attr("text-anchor", "end")
          .attr("y", -50)
          .attr("dy", ".75em")
          .attr("transform", "rotate(-90)")
          .text("Baseline Speeded Memory (Composite Score)");

      svg4.append("text")
          .attr("class", "y label")
          .attr("text-anchor", "end")
          .attr("y", -50)
          .attr("dy", ".75em")
          .attr("transform", "rotate(-90)")
          .text("Transfer of Executive Function (Composite Score)");

      svg4_1.append("text")
          .attr("class", "y label")
          .attr("text-anchor", "end")
          .attr("y", -50)
          .attr("dy", ".75em")
          .attr("transform", "rotate(-90)")
          .text("Transfer of Speeded Memory (Composite Score)");

      svg.append("text")
          .attr("class", "session label")
          .attr("text-anchor", "start")
          .attr("y", height - 180)
          .attr("x", width-196)
          .text("session");

      // Add the year label; the value is set on transition.
      var label1 = svg.append("text")
          .attr("class", "year label")
          .attr("text-anchor", "end")
          .attr("y", height - 24)
          .attr("x", width)
          .text(1);

      var label2 = svg2.append("text")
          .attr("class", "year label")
          .attr("text-anchor", "end")
          .attr("y", height - 24)
          .attr("x", width)
          .text(1);
// first graph


      // Create the SVG container and set the origin.
      var svg_general = d3.select("#chart-general").append("svg")
          .attr("width", width + margin.left + margin.right)
          .attr("height", height + margin.top + margin.bottom)
        .append("g")
          .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
      // Add the x-axis.
      svg_general.append("g")
          .attr("class", "x axis")
          .attr("transform", "translate(0," + height + ")")
          .call(xCorAxis);
      svg_general.append("g")
          .attr("class", "y axis")
          .call(yCorAxis);
      svg_general.append("text")
          .attr("class", "x label")
          .attr("text-anchor", "middle")
          .attr("x", widthCor/2)
          .attr("y", height + 50)
          .text("Training Session");
      svg_general.append("text")
          .attr("class", "y label")
          .attr("text-anchor", "end")
          .attr("y", -50)
          .attr("dy", ".75em")
          .attr("transform", "rotate(-90)")
          .text("Correlation game score and baseline abilities (r)");

      var dataset = [
                  [1, 0.432, "speeded memory"],
                  [2, 0.396, "speeded memory"],
                  [3, 0.492, "speeded memory"],
                  [4, 0.346, "speeded memory"],
                  [5, 0.333, "speeded memory"],
                  [6, 0.397, "speeded memory"],
                  [7, 0.416, "speeded memory"],
                  [8, 0.297, "speeded memory"],
                  [9, 0.325, "speeded memory"],
                  [10, 0.359, "speeded memory"],
                  [11, 0.334, "speeded memory"],
                  [12, 0.234, "speeded memory"],
                  [13, 0.312, "speeded memory"],
                  [14, 0.265, "speeded memory"],
                  [15, 0.32, "speeded memory"],
                  [1,0.571, "executive function"],
                  [2,0.567, "executive function"],
                  [3,0.602, "executive function"],
                  [4,0.541, "executive function"],
                  [5,0.533, "executive function"],
                  [6,0.498, "executive function"],
                  [7,0.454, "executive function"],
                  [8,0.401, "executive function"],
                  [9,0.303, "executive function"],
                  [10,0.307, "executive function"],
                  [11,0.347, "executive function"],
                  [12,0.357, "executive function"],
                  [13,0.339, "executive function"],
                  [14,0.329, "executive function"],
                  [15,0.344, "executive function"]
                  ]

    var line = d3.svg.line()
      // assign the X function to plot our line as we wish
      .x(function(d) { 
        return xCorScale(d[0]); 
      })
      .y(function(d) { 
        return yCorScale(d[1]); 
      })

    var wm = dataset.slice(0,15);
    var ef = dataset.slice(15);

    console.log (wm);
    console.log (ef); 

    svg_general.append("path")
          .datum(wm)
          .attr("class", "line-1")
          .attr("data-legend",function(d) {return d[0][2];})
          .attr("d", line)

    svg_general.append("path")
          .datum(ef)
          .attr("class", "line-2")
          .attr("data-legend",function(d) {return d[0][2];})
          .attr("d", line)

    svg_general.selectAll("circle")
           .data(dataset)
           .enter()
           .append("circle")
            .style("fill", "white")
            .style("stroke", function(d) {return colorScale(d[2]);} )
            .attr("cx", function(d) {
              return xCorScale(d[0]);
           })
           .attr("cy", function(d) {
              return yCorScale(d[1]);
           })
           .attr("r", 10);


    legend = svg_general.append("g")
        .attr("class","legend")
        .attr("transform","translate(50,30)")
        .call(d3.legend)



//////////////////////////////////////////////////////////////////////////////
      // Load the data.
      d3.json("sfdata.json", function(sfresults) {

        // A bisector since many sfresult's data is sparsely-defined.
        var bisect = d3.bisector(function(d) { return d[0]; });

        // Add button functions
        // All 
        d3.select("#update5")
        .on("click", function(d,i) {

        svg4.selectAll("path").data(lindata_fet4).exit().remove();
        svg4_1.selectAll("path").data(lindata_fet4_1).exit().remove();
        svg4.selectAll("path").data(lindata_fet4_early).exit().remove();
        svg4_1.selectAll("path").data(lindata_fet4_1_early).exit().remove();
        svg4.selectAll("path").data(lindata_fet4_middle).exit().remove();
        svg4_1.selectAll("path").data(lindata_fet4_1_middle).exit().remove();
        svg4.selectAll("path").data(lindata_fet4_late).exit().remove();
        svg4_1.selectAll("path").data(lindata_fet4_1_late).exit().remove();
           
        svg4.append("path")
          .datum(lindata_fet4)
          .attr("class", "reg_fet")
          .attr("d", regline);
        svg4.append("path")
          .datum(lindata_hvt4)
          .attr("class", "reg_hvt")
          .attr("d", regline);

        svg4_1.append("path")
          .datum(lindata_fet4_1)
          .attr("class", "reg_fet")
          .attr("d", regline);
        svg4_1.append("path")
          .datum(lindata_hvt4_1)
          .attr("class", "reg_hvt")
          .attr("d", regline);

          dot4.data(interpolateData(1), key).call(position4).sort(order);
          dot4_1.data(interpolateData(1), key).call(position4_1).sort(order);
        }) 
        // early
        d3.select("#update6")
        .on("click", function(d,i) {

        svg4.selectAll("path").data(lindata_fet4).exit().remove();
        svg4_1.selectAll("path").data(lindata_fet4_1).exit().remove();
        svg4.selectAll("path").data(lindata_fet4_early).exit().remove();
        svg4_1.selectAll("path").data(lindata_fet4_1_early).exit().remove();
        svg4.selectAll("path").data(lindata_fet4_middle).exit().remove();
        svg4_1.selectAll("path").data(lindata_fet4_1_middle).exit().remove();
        svg4.selectAll("path").data(lindata_fet4_late).exit().remove();
        svg4_1.selectAll("path").data(lindata_fet4_1_late).exit().remove();
           
        svg4.append("path")
          .datum(lindata_fet4_early)
          .attr("class", "reg_fet")
          .attr("d", regline);
        svg4.append("path")
          .datum(lindata_hvt4_early)
          .attr("class", "reg_hvt")
          .attr("d", regline);

        svg4_1.append("path")
          .datum(lindata_fet4_1_early)
          .attr("class", "reg_fet")
          .attr("d", regline);
        svg4_1.append("path")
          .datum(lindata_hvt4_1_early)
          .attr("class", "reg_hvt")
          .attr("d", regline);

        dot4.data(interpolateData(1), key).call(position4_early).sort(order);
        dot4_1.data(interpolateData(1), key).call(position4_1_early).sort(order);
        })
        // middle
        d3.select("#update7")
        .on("click", function(d,i) {
            
        svg4.selectAll("path").data(lindata_fet4).exit().remove();
        svg4_1.selectAll("path").data(lindata_fet4_1).exit().remove();
        svg4.selectAll("path").data(lindata_fet4_early).exit().remove();
        svg4_1.selectAll("path").data(lindata_fet4_1_early).exit().remove();
        svg4.selectAll("path").data(lindata_fet4_middle).exit().remove();
        svg4_1.selectAll("path").data(lindata_fet4_1_middle).exit().remove();
        svg4.selectAll("path").data(lindata_fet4_late).exit().remove();
        svg4_1.selectAll("path").data(lindata_fet4_1_late).exit().remove();
           
        svg4.append("path")
          .datum(lindata_fet4_middle)
          .attr("class", "reg_fet")
          .attr("d", regline);
        svg4.append("path")
          .datum(lindata_hvt4_middle)
          .attr("class", "reg_hvt")
          .attr("d", regline);

        svg4_1.append("path")
          .datum(lindata_fet4_1_middle)
          .attr("class", "reg_fet")
          .attr("d", regline);
        svg4_1.append("path")
          .datum(lindata_hvt4_1_middle)
          .attr("class", "reg_hvt")
          .attr("d", regline);

        dot4.data(interpolateData(1), key).call(position4_middle).sort(order);
        dot4_1.data(interpolateData(1), key).call(position4_1_middle).sort(order);

        })
        // late
        d3.select("#update8")
        .on("click", function(d,i) {
            dot4.data(interpolateData(1), key).call(position4_late).sort(order);
            dot4_1.data(interpolateData(1), key).call(position4_1_late).sort(order);

        svg4.selectAll("path").data(lindata_fet4).exit().remove();
        svg4_1.selectAll("path").data(lindata_fet4_1).exit().remove();
        svg4.selectAll("path").data(lindata_fet4_early).exit().remove();
        svg4_1.selectAll("path").data(lindata_fet4_1_early).exit().remove();
        svg4.selectAll("path").data(lindata_fet4_middle).exit().remove();
        svg4_1.selectAll("path").data(lindata_fet4_1_middle).exit().remove();
        svg4.selectAll("path").data(lindata_fet4_late).exit().remove();
        svg4_1.selectAll("path").data(lindata_fet4_1_late).exit().remove();
           
        svg4.append("path")
          .datum(lindata_fet4_late)
          .attr("class", "reg_fet")
          .attr("d", regline);
        svg4.append("path")
          .datum(lindata_hvt4_late)
          .attr("class", "reg_hvt")
          .attr("d", regline);

        svg4_1.append("path")
          .datum(lindata_fet4_1_late)
          .attr("class", "reg_fet")
          .attr("d", regline);
        svg4_1.append("path")
          .datum(lindata_hvt4_1_late)
          .attr("class", "reg_hvt")
          .attr("d", regline);
        })
      // All 
        d3.select("#update1")
        .on("click", function(d,i) {

        svg3.selectAll("path").data(lindata_fet3).exit().remove();
        svg3_1.selectAll("path").data(lindata_fet3_1).exit().remove();
        svg3.selectAll("path").data(lindata_fet3_early).exit().remove();
        svg3_1.selectAll("path").data(lindata_fet3_1_early).exit().remove();
        svg3.selectAll("path").data(lindata_fet3_middle).exit().remove();
        svg3_1.selectAll("path").data(lindata_fet3_1_middle).exit().remove();
        svg3.selectAll("path").data(lindata_fet3_late).exit().remove();
        svg3_1.selectAll("path").data(lindata_fet3_1_late).exit().remove();
           
        svg3.append("path")
          .datum(lindata_fet3)
          .attr("class", "reg_fet")
          .attr("d", regline);
        svg3.append("path")
          .datum(lindata_hvt3)
          .attr("class", "reg_hvt")
          .attr("d", regline);

        svg3_1.append("path")
          .datum(lindata_fet3_1)
          .attr("class", "reg_fet")
          .attr("d", regline);
        svg3_1.append("path")
          .datum(lindata_hvt3_1)
          .attr("class", "reg_hvt")
          .attr("d", regline);

        dot3.data(interpolateData(1), key).call(position3).sort(order);
        dot3_1.data(interpolateData(1), key).call(position3_1).sort(order);
        }) 
        // early
        d3.select("#update2")
        .on("click", function(d,i) {
            
        svg3.selectAll("path").data(lindata_fet3).exit().remove();
        svg3_1.selectAll("path").data(lindata_fet3_1).exit().remove();
        svg3.selectAll("path").data(lindata_fet3_early).exit().remove();
        svg3_1.selectAll("path").data(lindata_fet3_1_early).exit().remove();
        svg3.selectAll("path").data(lindata_fet3_middle).exit().remove();
        svg3_1.selectAll("path").data(lindata_fet3_1_middle).exit().remove();
        svg3.selectAll("path").data(lindata_fet3_late).exit().remove();
        svg3_1.selectAll("path").data(lindata_fet3_1_late).exit().remove();
           
        svg3.append("path")
          .datum(lindata_fet3_early)
          .attr("class", "reg_fet")
          .attr("d", regline);
        svg3.append("path")
          .datum(lindata_hvt3_early)
          .attr("class", "reg_hvt")
          .attr("d", regline);

        svg3_1.append("path")
          .datum(lindata_fet3_1_early)
          .attr("class", "reg_fet")
          .attr("d", regline);
        svg3_1.append("path")
          .datum(lindata_hvt3_1_early)
          .attr("class", "reg_hvt")
          .attr("d", regline);

        dot3.data(interpolateData(1), key).call(position3_early).sort(order);
        dot3_1.data(interpolateData(1), key).call(position3_1_early).sort(order);

        })
        // middle
        d3.select("#update3")
        .on("click", function(d,i) {
            dot3.data(interpolateData(1), key).call(position3_middle).sort(order);
            dot3_1.data(interpolateData(1), key).call(position3_1_middle).sort(order);

        svg3.selectAll("path").data(lindata_fet3).exit().remove();
        svg3_1.selectAll("path").data(lindata_fet3_1).exit().remove();
        svg3.selectAll("path").data(lindata_fet3_early).exit().remove();
        svg3_1.selectAll("path").data(lindata_fet3_1_early).exit().remove();
        svg3.selectAll("path").data(lindata_fet3_middle).exit().remove();
        svg3_1.selectAll("path").data(lindata_fet3_1_middle).exit().remove();
        svg3.selectAll("path").data(lindata_fet3_late).exit().remove();
        svg3_1.selectAll("path").data(lindata_fet3_1_late).exit().remove();
           
        svg3.append("path")
          .datum(lindata_fet3_middle)
          .attr("class", "reg_fet")
          .attr("d", regline);
        svg3.append("path")
          .datum(lindata_hvt3_middle)
          .attr("class", "reg_hvt")
          .attr("d", regline);

        svg3_1.append("path")
          .datum(lindata_fet3_1_middle)
          .attr("class", "reg_fet")
          .attr("d", regline);
        svg3_1.append("path")
          .datum(lindata_hvt3_1_middle)
          .attr("class", "reg_hvt")
          .attr("d", regline);

        dot3.data(interpolateData(1), key).call(position3_middle).sort(order);
        dot3_1.data(interpolateData(1), key).call(position3_1_middle).sort(order);
        })
        // late
        d3.select("#update4")
        .on("click", function(d,i) {
            
        svg3.selectAll("path").data(lindata_fet3).exit().remove();
        svg3_1.selectAll("path").data(lindata_fet3_1).exit().remove();
        svg3.selectAll("path").data(lindata_fet3_early).exit().remove();
        svg3_1.selectAll("path").data(lindata_fet3_1_early).exit().remove();
        svg3.selectAll("path").data(lindata_fet3_middle).exit().remove();
        svg3_1.selectAll("path").data(lindata_fet3_1_middle).exit().remove();
        svg3.selectAll("path").data(lindata_fet3_late).exit().remove();
        svg3_1.selectAll("path").data(lindata_fet3_1_late).exit().remove();
           
        svg3.append("path")
          .datum(lindata_fet3_late)
          .attr("class", "reg_fet")
          .attr("d", regline);
        svg3.append("path")
          .datum(lindata_hvt3_late)
          .attr("class", "reg_hvt")
          .attr("d", regline);

        svg3_1.append("path")
          .datum(lindata_fet3_1_late)
          .attr("class", "reg_fet")
          .attr("d", regline);
        svg3_1.append("path")
          .datum(lindata_hvt3_1_late)
          .attr("class", "reg_hvt")
          .attr("d", regline);

          dot3.data(interpolateData(1), key).call(position3_late).sort(order);
          dot3_1.data(interpolateData(1), key).call(position3_1_late).sort(order);

        })
        // Add line for correlation graphs -------------------------------
        var linedata = twoGroupData().map(function(d) {
            return d.EFCor;
          });
        var linedata_data = splitArray(linedata);

        var linedata2 = twoGroupData().map(function(d) {
            return d.WMCor;
          });
        var linedata_data2 = splitArray(linedata2);

        function splitArray(candid) {
            var oddOnes = [],
                evenOnes = [];
            for(var i=0; i<candid.length; i++)
                (i % 2 == 0 ? evenOnes : oddOnes).push(candid[i]);
            return [evenOnes, oddOnes];
        }
        
        var line = d3.svg.line()
          // assign the X function to plot our line as we wish
          .x(function(d,i) { 
            return xCorScale(i+1); 
          })
          .y(function(d) { 
            return yCorScale(d); 
          })
        
        svg_c.append("path")
          .datum(linedata_data[0])
          .attr("class", "line")
          .attr("d", line);

        svg_c.append("path")
          .datum(linedata_data[1])
          .attr("class", "line2")
          .attr("d", line);

        svg_c2.append("path")
          .datum(linedata_data2[0])
          .attr("class", "line")
          .attr("d", line);

        svg_c2.append("path")
          .datum(linedata_data2[1])
          .attr("class", "line2")
          .attr("d", line);

        // Add regression line---------------------------------------
        var fet_data = interpolateData(1).splice(0,25);
        var hvt_data = interpolateData(1).splice(25,50);
        
        // svg 3 EF and game :: all
        var lin_fet3 = ss.linear_regression().data(fet_data.map(function(d) {
            return [+d.total_improve_residual, d.baselineEF_residual];
          })).line();

        var lin_hvt3 = ss.linear_regression().data(hvt_data.map(function(d) {
            return [+d.total_improve_residual, d.baselineEF_residual];
          })).line();
        
        var lindata_fet3 = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_fet3(+x)
            };
          });
        var lindata_hvt3 = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_hvt3(+x)
            };
          });
        // svg 3_1 WM and game
        var lin_fet3_1 = ss.linear_regression().data(fet_data.map(function(d) {
            return [+d.total_improve_residual, d.baselineWM_residual];
          })).line();

        var lin_hvt3_1 = ss.linear_regression().data(hvt_data.map(function(d) {
            return [+d.total_improve_residual, d.baselineWM_residual];
          })).line();
        
        var lindata_fet3_1 = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_fet3_1(+x)
            };
          });
        var lindata_hvt3_1 = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_hvt3_1(+x)
            };
          });
        // svg 4 WM and game
        var lin_fet4 = ss.linear_regression().data(fet_data.map(function(d) {
            return [+d.total_improve_residual, d.EFimprove_residual];
          })).line();

        var lin_hvt4 = ss.linear_regression().data(hvt_data.map(function(d) {
            return [+d.total_improve_residual, d.EFimprove_residual];
          })).line();
        
        var lindata_fet4 = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_fet4(+x)
            };
          });
        var lindata_hvt4 = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_hvt4(+x)
            };
          });
        // svg 4_1 WM and game
        var lin_fet4_1 = ss.linear_regression().data(fet_data.map(function(d) {
            return [+d.total_improve_residual, d.WMimprove_residual];
          })).line();

        var lin_hvt4_1 = ss.linear_regression().data(hvt_data.map(function(d) {
            return [+d.total_improve_residual, d.WMimprove_residual];
          })).line();
        
        var lindata_fet4_1 = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_fet4_1(+x)
            };
          });
        var lindata_hvt4_1 = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_hvt4_1(+x)
            };
          });

        // svg 3 EF and game :: early
        var lin_fet3_early = ss.linear_regression().data(fet_data.map(function(d) {
            return [+d.total_improve_early_residual, d.baselineEF_residual];
          })).line();

        var lin_hvt3_early = ss.linear_regression().data(hvt_data.map(function(d) {
            return [+d.total_improve_early_residual, d.baselineEF_residual];
          })).line();
        
        var lindata_fet3_early = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_fet3_early(+x)
            };
          });
        var lindata_hvt3_early = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_hvt3_early(+x)
            };
          });
        // svg 3_1 WM and game
        var lin_fet3_1_early = ss.linear_regression().data(fet_data.map(function(d) {
            return [+d.total_improve_early_residual, d.baselineWM_residual];
          })).line();

        var lin_hvt3_1_early = ss.linear_regression().data(hvt_data.map(function(d) {
            return [+d.total_improve_early_residual, d.baselineWM_residual];
          })).line();
        
        var lindata_fet3_1_early = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_fet3_1_early(+x)
            };
          });
        var lindata_hvt3_1_early = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_hvt3_1_early(+x)
            };
          });
        // svg 4 WM and game
        var lin_fet4_early = ss.linear_regression().data(fet_data.map(function(d) {
            return [+d.total_improve_early_residual, d.EFimprove_residual];
          })).line();

        var lin_hvt4_early = ss.linear_regression().data(hvt_data.map(function(d) {
            return [+d.total_improve_early_residual, d.EFimprove_residual];
          })).line();
        
        var lindata_fet4_early = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_fet4_early(+x)
            };
          });
        var lindata_hvt4_early = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_hvt4_early(+x)
            };
          });
        // svg 4_1 WM and game
        var lin_fet4_1_early = ss.linear_regression().data(fet_data.map(function(d) {
            return [+d.total_improve_early_residual, d.WMimprove_residual];
          })).line();

        var lin_hvt4_1_early = ss.linear_regression().data(hvt_data.map(function(d) {
            return [+d.total_improve_early_residual, d.WMimprove_residual];
          })).line();
        
        var lindata_fet4_1_early = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_fet4_1_early(+x)
            };
          });
        var lindata_hvt4_1_early = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_hvt4_1_early(+x)
            };
          });

        // svg 3 EF and game :: late
        var lin_fet3_late = ss.linear_regression().data(fet_data.map(function(d) {
            return [+d.total_improve_late_residual, d.baselineEF_residual];
          })).line();

        var lin_hvt3_late = ss.linear_regression().data(hvt_data.map(function(d) {
            return [+d.total_improve_late_residual, d.baselineEF_residual];
          })).line();
        
        var lindata_fet3_late = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_fet3_late(+x)
            };
          });
        var lindata_hvt3_late = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_hvt3_late(+x)
            };
          });
        // svg 3_1 WM and game
        var lin_fet3_1_late = ss.linear_regression().data(fet_data.map(function(d) {
            return [+d.total_improve_late_residual, d.baselineWM_residual];
          })).line();

        var lin_hvt3_1_late = ss.linear_regression().data(hvt_data.map(function(d) {
            return [+d.total_improve_late_residual, d.baselineWM_residual];
          })).line();
        
        var lindata_fet3_1_late = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_fet3_1_late(+x)
            };
          });
        var lindata_hvt3_1_late = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_hvt3_1_late(+x)
            };
          });
        // svg 4 WM and game
        var lin_fet4_late = ss.linear_regression().data(fet_data.map(function(d) {
            return [+d.total_improve_late_residual, d.EFimprove_residual];
          })).line();

        var lin_hvt4_late = ss.linear_regression().data(hvt_data.map(function(d) {
            return [+d.total_improve_late_residual, d.EFimprove_residual];
          })).line();
        
        var lindata_fet4_late = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_fet4_late(+x)
            };
          });
        var lindata_hvt4_late = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_hvt4_late(+x)
            };
          });
        // svg 4_1 WM and game
        var lin_fet4_1_late = ss.linear_regression().data(fet_data.map(function(d) {
            return [+d.total_improve_late_residual, d.WMimprove_residual];
          })).line();

        var lin_hvt4_1_late = ss.linear_regression().data(hvt_data.map(function(d) {
            return [+d.total_improve_late_residual, d.WMimprove_residual];
          })).line();
        
        var lindata_fet4_1_late = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_fet4_1_late(+x)
            };
          });
        var lindata_hvt4_1_late = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_hvt4_1_late(+x)
            };
          });

        // svg 3 EF and game :: middle
        var lin_fet3_middle = ss.linear_regression().data(fet_data.map(function(d) {
            return [+d.total_improve_middle_residual, d.baselineEF_residual];
          })).line();

        var lin_hvt3_middle = ss.linear_regression().data(hvt_data.map(function(d) {
            return [+d.total_improve_middle_residual, d.baselineEF_residual];
          })).line();
        
        var lindata_fet3_middle = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_fet3_middle(+x)
            };
          });
        var lindata_hvt3_middle = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_hvt3_middle(+x)
            };
          });
        // svg 3_1 WM and game
        var lin_fet3_1_middle = ss.linear_regression().data(fet_data.map(function(d) {
            return [+d.total_improve_middle_residual, d.baselineWM_residual];
          })).line();

        var lin_hvt3_1_middle = ss.linear_regression().data(hvt_data.map(function(d) {
            return [+d.total_improve_middle_residual, d.baselineWM_residual];
          })).line();
        
        var lindata_fet3_1_middle = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_fet3_1_middle(+x)
            };
          });
        var lindata_hvt3_1_middle = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_hvt3_1_middle(+x)
            };
          });
        // svg 4 WM and game
        var lin_fet4_middle = ss.linear_regression().data(fet_data.map(function(d) {
            return [+d.total_improve_middle_residual, d.EFimprove_residual];
          })).line();

        var lin_hvt4_middle = ss.linear_regression().data(hvt_data.map(function(d) {
            return [+d.total_improve_middle_residual, d.EFimprove_residual];
          })).line();
        
        var lindata_fet4_middle = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_fet4_middle(+x)
            };
          });
        var lindata_hvt4_middle = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_hvt4_middle(+x)
            };
          });
        // svg 4_1 WM and game
        var lin_fet4_1_middle = ss.linear_regression().data(fet_data.map(function(d) {
            return [+d.total_improve_middle_residual, d.WMimprove_residual];
          })).line();

        var lin_hvt4_1_middle = ss.linear_regression().data(hvt_data.map(function(d) {
            return [+d.total_improve_middle_residual, d.WMimprove_residual];
          })).line();
        
        var lindata_fet4_1_middle = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_fet4_1_middle(+x)
            };
          });
        var lindata_hvt4_1_middle = ximproveScale.domain().map(function(x) {
            return {
              x: x,
              y: lin_hvt4_1_middle(+x)
            };
          });
  
        var regline = d3.svg.line()
          // assign the X function to plot our line as we wish
          .x(function(d) { 
            return ximproveScale(d.x); 
          })
          .y(function(d) { 
            return yScale(d.y); 
          })

        // Initial drawing  
        svg3.append("path")
          .datum(lindata_fet3)
          .attr("class", "reg_fet")
          .attr("d", regline);
        svg3.append("path")
          .datum(lindata_hvt3)
          .attr("class", "reg_hvt")
          .attr("d", regline);

        svg3_1.append("path")
          .datum(lindata_fet3_1)
          .attr("class", "reg_fet")
          .attr("d", regline);
        svg3_1.append("path")
          .datum(lindata_hvt3_1)
          .attr("class", "reg_hvt")
          .attr("d", regline);

        svg4.append("path")
          .datum(lindata_fet4)
          .attr("class", "reg_fet")
          .attr("d", regline);
        svg4.append("path")
          .datum(lindata_hvt4)
          .attr("class", "reg_hvt")
          .attr("d", regline);

        svg4_1.append("path")
          .datum(lindata_fet4_1)
          .attr("class", "reg_fet")
          .attr("d", regline);
        svg4_1.append("path")
          .datum(lindata_hvt4_1)
          .attr("class", "reg_hvt")
          .attr("d", regline);

        // Add a dot per sfresult. Initialize the data at 1, and set the colors.
        var dot = svg.append("g")
            .attr("class", "dots")
          .selectAll(".dot")
            .data(interpolateData(1))
          .enter().append("circle")
            .attr("class", "dot")
            .attr("data-legend",function(d) { return color(d);})
            .style("fill", function(d) { return colorScale(color(d)); })
            .call(position)
            .sort(order);

        var dotC_re = svg_c.append("g")
            .attr("class", "dots")
          .selectAll(".dot")
            .data(twoGroupData())
          .enter().append("circle")
            .attr("class", "dot")
            .style("fill", "white")
            .style("stroke", function(d) { return colorScale(color(d)); })
            .call(positionC)
            .sort(order); 
        
        var dotC = svg_c.append("g")
            .attr("class", "dots")
          .selectAll(".dot")
            .data([interpolateData(1)[0],interpolateData(1)[49]])
          .enter().append("circle")
            .attr("class", "dot")
            .attr("data-legend",function(d) { return color(d);})
            .style("fill", function(d) { return colorScale(color(d)); })
            .call(positionC)
            .sort(order); 

        var dot2 = svg2.append("g")
            .attr("class", "dots")
          .selectAll(".dot")
            .data(interpolateData(1))
          .enter().append("circle")
            .attr("class", "dot")
            .attr("data-legend",function(d) { console.log(d); return color(d);})
            .style("fill", function(d) { return colorScale(color(d)); })
            .call(position2)
            .sort(order);

        var dotC2_re = svg_c2.append("g")
            .attr("class", "dots")
          .selectAll(".dot")
            .data(twoGroupData())
          .enter().append("circle")
            .attr("class", "dot")
            .style("fill", "white")
            .style("stroke", function(d) { return colorScale(color(d)); })
            .call(positionC2)
            .sort(order); 

        var dotC2 = svg_c2.append("g")
            .attr("class", "dots")
          .selectAll(".dot")
            .data([interpolateData(1)[0],interpolateData(1)[49]])
          .enter().append("circle")
            .attr("class", "dot")
            .attr("data-legend",function(d) { return color(d);})
            .style("fill", function(d) { return colorScale(color(d)); })
            .call(positionC2)
            .sort(order); 

        var dot3 = svg3.append("g")
            .attr("class", "dots")
          .selectAll(".dot")
            .data(interpolateData(1))
          .enter().append("circle")
            .attr("class", "dot")
            .attr("data-legend",function(d) { return color(d);})
            .style("fill", function(d) { return colorScale(color(d)); })
            .call(position3)
            .sort(order);

        var dot3_1 = svg3_1.append("g")
            .attr("class", "dots")
          .selectAll(".dot")
            .data(interpolateData(1))
          .enter().append("circle")
            .attr("class", "dot")
            .attr("data-legend",function(d) { return color(d);})
            .style("fill", function(d) { return colorScale(color(d)); })
            .call(position3_1)
            .sort(order);

        var dot4 = svg4.append("g")
            .attr("class", "dots")
          .selectAll(".dot")
            .data(interpolateData(1))
          .enter().append("circle")
            .attr("class", "dot")
            .attr("data-legend",function(d) { return color(d);})
            .style("fill", function(d) { return colorScale(color(d)); })
            .call(position4)
            .sort(order);

        var dot4_1 = svg4_1.append("g")
            .attr("class", "dots")
          .selectAll(".dot")
            .data(interpolateData(1))
          .enter().append("circle")
            .attr("class", "dot")
            .attr("data-legend",function(d) { return color(d);})
            .style("fill", function(d) { return colorScale(color(d)); })
            .call(position4_1)
            .sort(order);

        // Add a title.
        dot.append("title")
            .text(function(d) { return name(d); });

        dotC_re.append("title")
            .text(function(d) { return d.EFCor; });  

        dotC2_re.append("title")
            .text(function(d) { return d.WMCor; }); 

        // Add a legend
        legend = svg.append("g")
        .attr("class","legend")
        .attr("transform","translate(50,30)")
        .call(d3.legend)

        legend = svg2.append("g")
        .attr("class","legend")
        .attr("transform","translate(50,30)")
        .call(d3.legend)

        legend = svg3.append("g")
        .attr("class","legend")
        .attr("transform","translate(50,30)")
        .call(d3.legend)

        legend = svg3_1.append("g")
        .attr("class","legend")
        .attr("transform","translate(50,30)")
        .call(d3.legend)

        legend = svg4.append("g")
        .attr("class","legend")
        .attr("transform","translate(50,30)")
        .call(d3.legend)

        legend = svg4_1.append("g")
        .attr("class","legend")
        .attr("transform","translate(50,30)")
        .call(d3.legend)

        // Add an overlay for the year label.
        var box = label1.node().getBBox();

        var overlay = svg.append("rect")
              .attr("class", "overlay")
              .attr("x", box.x)
              .attr("y", box.y)
              .attr("width", box.width)
              .attr("height", box.height)
              .on("mouseover", enableInteraction);

        var overlay2 = svg2.append("rect")
              .attr("class", "overlay")
              .attr("x", box.x)
              .attr("y", box.y)
              .attr("width", box.width)
              .attr("height", box.height)
              .on("mouseover", enableInteraction);


        // Start a transition that interpolates the data based on year.
        svg.transition()
            .duration(20000)
            .ease("linear")
            .tween("year", tweenYear)
            .each("end", enableInteraction);

        svg2.transition()
            .duration(20000)
            .ease("linear")
            .tween("year", tweenYear)
            .each("end", enableInteraction);

        // Positions the dots based on data.
        function position(dot) {
          dot .attr("cx", function(d) { return xScale(d.gameScore); })
              .attr("cy", function(d) { return yScale(d.baselineEF); })
              .attr("r", function(d) { return d.dotSize});
        }
        function position2(dot2) {
          dot2 .attr("cx", function(d) { return xScale(d.gameScore); })
              .attr("cy", function(d) { return yScale(d.baselineWM); })
              .attr("r", function(d) { return d.dotSize});
        }
        function positionC(dotC) {
          dotC .attr("cx", function(d) { return xCorScale(d.session); })
              .attr("cy", function(d) { return yCorScale(d.EFCor); })
              .attr("r", function(d) { return d.dotSize});
        }
        function positionC2(dotC2) {
          dotC2 .attr("cx", function(d) { return xCorScale(d.session); })
              .attr("cy", function(d) { return yCorScale(d.WMCor); })
              .attr("r", function(d) { return d.dotSize});
        }
        function position3(dot3) {
          dot3 .attr("cx", function(d) {return ximproveScale(d.total_improve_residual); })
              .attr("cy", function(d) { return yScale(d.baselineEF_residual); })
              .attr("r", function(d) { return d.dotSize});
        }
        function position4(dot4) {
          dot4 .attr("cx", function(d) { return ximproveScale(d.total_improve_residual); })
              .attr("cy", function(d) { return yScale(d.EFimprove_residual); })
              .attr("r", function(d) { return d.dotSize});
        }
        function position3_1(dot3_1) {
          dot3_1 .attr("cx", function(d) {return ximproveScale(d.total_improve_residual); })
              .attr("cy", function(d) { return yScale(d.baselineWM_residual); })
              .attr("r", function(d) { return d.dotSize});
        }
        function position4_1(dot4_1) {
          dot4_1 .attr("cx", function(d) { return ximproveScale(d.total_improve_residual); })
              .attr("cy", function(d) { return yScale(d.WMimprove_residual); })
              .attr("r", function(d) { return d.dotSize});
        }
        function position3_early(dot3) {
          dot3 .attr("cx", function(d) {return ximproveScale(d.total_improve_early_residual); })
              .attr("cy", function(d) { return yScale(d.baselineEF_residual); })
              .attr("r", function(d) { return d.dotSize});
        }
        function position4_early(dot4) {
          dot4 .attr("cx", function(d) { return ximproveScale(d.total_improve_early_residual); })
              .attr("cy", function(d) { return yScale(d.EFimprove_residual); })
              .attr("r", function(d) { return d.dotSize});
        }
        function position3_1_early(dot3_1) {
          dot3_1 .attr("cx", function(d) {return ximproveScale(d.total_improve_early_residual); })
              .attr("cy", function(d) { return yScale(d.baselineWM_residual); })
              .attr("r", function(d) { return d.dotSize});
        }
        function position4_1_early(dot4_1) {
          dot4_1 .attr("cx", function(d) { return ximproveScale(d.total_improve_early_residual); })
              .attr("cy", function(d) { return yScale(d.WMimprove_residual); })
              .attr("r", function(d) { return d.dotSize});
        }
        function position3_middle(dot3) {
          dot3 .attr("cx", function(d) {return ximproveScale(d.total_improve_middle_residual); })
              .attr("cy", function(d) { return yScale(d.baselineEF_residual); })
              .attr("r", function(d) { return d.dotSize});
        }
        function position4_middle(dot4) {
          dot4 .attr("cx", function(d) { return ximproveScale(d.total_improve_middle_residual); })
              .attr("cy", function(d) { return yScale(d.EFimprove_residual); })
              .attr("r", function(d) { return d.dotSize});
        }
        function position3_1_middle(dot3_1) {
          dot3_1 .attr("cx", function(d) {return ximproveScale(d.total_improve_middle_residual); })
              .attr("cy", function(d) { return yScale(d.baselineWM_residual); })
              .attr("r", function(d) { return d.dotSize});
        }
        function position4_1_middle(dot4_1) {
          dot4_1 .attr("cx", function(d) { return ximproveScale(d.total_improve_middle_residual); })
              .attr("cy", function(d) { return yScale(d.WMimprove_residual); })
              .attr("r", function(d) { return d.dotSize});
        }
        function position3_late(dot3) {
          dot3 .attr("cx", function(d) {return ximproveScale(d.total_improve_late_residual); })
              .attr("cy", function(d) { return yScale(d.baselineEF_residual); })
              .attr("r", function(d) { return d.dotSize});
        }
        function position4_late(dot4) {
          dot4 .attr("cx", function(d) { return ximproveScale(d.total_improve_late_residual); })
              .attr("cy", function(d) { return yScale(d.EFimprove_residual); })
              .attr("r", function(d) { return d.dotSize});
        }
        function position3_1_late(dot3_1) {
          dot3_1 .attr("cx", function(d) {return ximproveScale(d.total_improve_late_residual); })
              .attr("cy", function(d) { return yScale(d.baselineWM_residual); })
              .attr("r", function(d) { return d.dotSize});
        }
        function position4_1_late(dot4_1) {
          dot4_1 .attr("cx", function(d) { return ximproveScale(d.total_improve_late_residual); })
              .attr("cy", function(d) { return yScale(d.WMimprove_residual); })
              .attr("r", function(d) { return d.dotSize});
        }

        // Defines a sort order so that the smallest dots are drawn on top.
        function order(a, b) {
          return radius(b) - radius(a);
        }

        // After the transition finishes, you can mouseover to change the year.
        function enableInteraction() {
          var yearScale = d3.scale.linear()
              .domain([1, 15])
              .range([box.x + 10, box.x + box.width - 10])
              .clamp(true);

          // Cancel the current transition, if any.
          svg.transition().duration(0);
          svg2.transition().duration(0);


          overlay
              .on("mouseover", mouseover)
              .on("mouseout", mouseout)
              .on("mousemove", mousemove)
              .on("touchmove", mousemove);

          overlay2
              .on("mouseover", mouseover)
              .on("mouseout", mouseout)
              .on("mousemove", mousemove)
              .on("touchmove", mousemove);

          function mouseover() {
            label1.classed("active", true);
          }

          function mouseout() {
            label1.classed("active", false);
          }

          function mousemove() {
            displayYear(yearScale.invert(d3.mouse(this)[0]));
          }
        }

        // Tweens the entire chart by first tweening the year, and then the data.
        // For the interpolated data, the dots and label are #d62728rawn.
        function tweenYear() {
          var year = d3.interpolateNumber(1, 15);
          return function(t) { displayYear(year(t)); };
        }

        // Updates the display to show the specified year.
        function displayYear(year) {
          dot.data(interpolateData(year), key).call(position).sort(order);
          label1.text(Math.round(year));
          dot2.data(interpolateData(year), key).call(position2).sort(order);
          label2.text(Math.round(year));
          dotC.data([interpolateData(year)[0],interpolateData(year)[49]], key).call(positionC).sort(order);
          dotC2.data([interpolateData(year)[0],interpolateData(year)[49]], key).call(positionC2).sort(order);
        }

        // Interpolates the dataset for the given (fractional) year.
        function interpolateData(year) {
          return sfresults.map(function(d) {
            return {
              name: d.name,
              group: d.group,
              gameScore: interpolateValues(d.gameScore, year),
              gameScore_residual: interpolateValues(d.game_residual, year),
              dotSize: 10,
              baselineEF: d.baselineEF,
              baselineWM: d.baselineWM,
              baselineEF_residual: d.baseEF_residual,
              baselineWM_residual: d.baseWM_residual,
              session: year,
              EFCor: interpolateValues(d.EF_correlation, year),
              WMCor: interpolateValues(d.WM_correlation, year),
              EFimprove: d.reasoning_improve,
              WMimprove: d.attMemory_improve,
              EFimprove_residual: d.improveEF_residual,
              WMimprove_residual: d.improveWM_residual,
              total_improve: d.total_improve,
              total_improve_early: d.total_improve_early,
              total_improve_middle: d.total_improve_middle_only,
              total_improve_late: d.total_improve_late_only,
              total_improve_residual: d.totalImproveAll_residual,
              total_improve_early_residual: d.totalImproveEarly_residual,
              total_improve_middle_residual: d.totalImproveMiddle_residual,
              total_improve_late_residual: d.totalImproveLate_residual
            };
          });
        }

        function twoGroupData() {
          var twoGroup = [interpolateData(1)[0],interpolateData(1)[49],interpolateData(2)[0],interpolateData(2)[49],interpolateData(3)[0],interpolateData(3)[49],interpolateData(4)[0],interpolateData(4)[49],interpolateData(5)[0],interpolateData(5)[49],interpolateData(6)[0],interpolateData(6)[49],interpolateData(7)[0],interpolateData(7)[49],interpolateData(8)[0],interpolateData(8)[49],interpolateData(9)[0],interpolateData(9)[49],interpolateData(10)[0],interpolateData(10)[49],interpolateData(11)[0],interpolateData(11)[49],interpolateData(12)[0],interpolateData(12)[49],interpolateData(13)[0],interpolateData(13)[49],interpolateData(14)[0],interpolateData(14)[49],interpolateData(15)[0],interpolateData(15)[49]];
          return twoGroup;
        }
        
    
        // Finds (and possibly interpolates) the value for the specified year.
        function interpolateValues(values, year) {
          var i = bisect.left(values, year, 0, values.length - 1),
              a = values[i];
          if (i > 0) {
            var b = values[i - 1],
                t = (year - a[0]) / (b[0] - a[0]);
            return a[1] * (1 - t) + b[1] * t;
          }
          return a[1];
        }
      });

    </script>

    </div>  

        <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="js/jquery.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="js/bootstrap.min.js"></script>
    <!--script src="js/d3.v3.min.js"></script-->
  </body>
</html>